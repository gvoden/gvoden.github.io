<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Integrating Entra B2C with Amazon API Gateway using JWT authorizer</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Integrating Entra B2C with Amazon API Gateway using JWT authorizer</h1>
</header>
<section data-field="subtitle" class="p-summary">
Entra ID can integrate with Amazon API Gateway using the Oauth2 authorization protocol. This is particularly useful if you want to secure…
</section>
<section data-field="body" class="e-content">
<section name="1a87" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="05a0" id="05a0" class="graf graf--h3 graf--leading graf--title">Integrating Entra B2C with Amazon API Gateway using JWT authorizer</h3><p name="788d" id="788d" class="graf graf--p graf-after--h3">Entra ID can integrate with Amazon API Gateway using the Oauth2 authorization protocol. This is particularly useful if you want to secure APIs for machine to machine calls and you are familiar with Azure and choose not to use Amazon Cognito or an alternative IdP. The below diagram depicts a Entra ID B2C integration for the Client Credentials oauth grant:</p><figure name="041b" id="041b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*0zCLgswIqxIi0Zs5-CERSQ.png" data-width="1047" data-height="684" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*0zCLgswIqxIi0Zs5-CERSQ.png"><figcaption class="imageCaption">High level architecture, open sourced, courtesy of <a href="https://github.com/secinaction101/azureadawsapigateway" data-href="https://github.com/secinaction101/azureadawsapigateway" class="markup--anchor markup--figure-anchor" rel="nofollow noopener" target="_blank">https://github.com/secinaction101/azureadawsapigateway</a></figcaption></figure><p name="3652" id="3652" class="graf graf--p graf-after--figure">Step by step configuration can be found in this Microsoft article: <a href="https://learn.microsoft.com/en-us/azure/active-directory-b2c/client-credentials-grant-flow?pivots=b2c-user-flow" data-href="https://learn.microsoft.com/en-us/azure/active-directory-b2c/client-credentials-grant-flow?pivots=b2c-user-flow" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://learn.microsoft.com/en-us/azure/active-directory-b2c/client-credentials-grant-flow?pivots=b2c-user-flow</a></p><p name="eeeb" id="eeeb" class="graf graf--p graf-after--p">Note on how to get started: a Entra ID B2C tenant is required. You can use a free trial or pay-as-you-go Azure environment. You will also need an AWS account to create an API Gateway (I believe it only charges you if you have a large number of API calls, otherwise the cost is minimal). I used this site to poll fake data through the gateway using Postman: <a href="https://jsonplaceholder.typicode.com/" data-href="https://jsonplaceholder.typicode.com/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://jsonplaceholder.typicode.com/</a></p><p name="459c" id="459c" class="graf graf--p graf-after--p">Azure side configuration looks as follows:</p><figure name="ca40" id="ca40" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*InGmwotuxKzpRRVP.png" data-width="1058" data-height="482" src="https://cdn-images-1.medium.com/max/800/0*InGmwotuxKzpRRVP.png"></figure><p name="f498" id="f498" class="graf graf--p graf-after--figure">You need to create 2 App registrations in Azure B2C (make sure to create a Azure B2C directory first, do not use the default Azure AD (Entra ID).</p><p name="1be1" id="1be1" class="graf graf--p graf-after--p">App1 represents the client credentials app, and App2 represents the Web API you will be calling. Note that these are just security configuration in your IdP.</p><p name="a332" id="a332" class="graf graf--p graf-after--p">Example oauth flow trigger using Postman:</p><ol class="postList"><li name="dcdc" id="dcdc" class="graf graf--li graf-after--p">We pass the client_id, client_secret and scope in a POST request</li><li name="8553" id="8553" class="graf graf--li graf-after--li">The endpoint returns the access token (JWT token) that we then use to access the HTTP endpoint behind Amazon API Gateway</li></div><div class="section-inner sectionLayout--outsetColumn"></ol><figure name="36ef" id="36ef" class="graf graf--figure graf--layoutOutsetCenter graf-after--li"><img class="graf-image" data-image-id="1*195BjqW1iyGPHdOw7Nosyg.png" data-width="1491" data-height="802" src="https://cdn-images-1.medium.com/max/1200/1*195BjqW1iyGPHdOw7Nosyg.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="876e" id="876e" class="graf graf--p graf-after--figure">NOTE: You can decode the token to see the values it contains, such as scope, issuer, audience etc by going to jwt.io and pasting the value:</p><figure name="9192" id="9192" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*gW5rMhFiHraPMgJi-wz32A.png" data-width="1131" data-height="806" src="https://cdn-images-1.medium.com/max/800/1*gW5rMhFiHraPMgJi-wz32A.png"></figure><p name="7de6" id="7de6" class="graf graf--p graf-after--figure">We then take the JWT token and pass that in the Authorization header to be used in the request to the API Gateway endpoint, the request is successful as we see mock data being returned, which means our token was authorized by the AWS API Gateway JWT authorizer:</p><figure name="696c" id="696c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*QnBZGgiL5H0uCftX" data-width="1054" data-height="619" src="https://cdn-images-1.medium.com/max/800/0*QnBZGgiL5H0uCftX"></figure><p name="c488" id="c488" class="graf graf--p graf-after--figure">Additional security can be achieved by adding scopes/permissions in the Client credentials app in Entra B2C which will be encoded in the JWT. On API Gateway side, the authorizer can validate the scopes after decoding the token.</p><p name="cade" id="cade" class="graf graf--p graf-after--p">Sample AWS API Gateway configuration can be seen below:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="6f7a" id="6f7a" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*VL3QuDmfCZ_RjpAHOk-KRQ.png" data-width="1429" data-height="803" src="https://cdn-images-1.medium.com/max/1200/1*VL3QuDmfCZ_RjpAHOk-KRQ.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="771c" id="771c" class="graf graf--p graf-after--figure">Revoking the app.read permissions on the Client Credentials App side in Azure B2C will result in a “Forbidden” HTTP response like so:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="5ec9" id="5ec9" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*aEbEQNM1LtTAe6yt7myjdA.png" data-width="1688" data-height="902" src="https://cdn-images-1.medium.com/max/1200/1*aEbEQNM1LtTAe6yt7myjdA.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="38ac" id="38ac" class="graf graf--p graf-after--figure">Postman test results:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="76e4" id="76e4" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*LUE5VdSXQWPWmq8EsiC1Vw.png" data-width="1242" data-height="784" src="https://cdn-images-1.medium.com/max/1200/1*LUE5VdSXQWPWmq8EsiC1Vw.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="9d3e" id="9d3e" class="graf graf--p graf-after--figure">This is because the JWT token no longer carries the app.read permissions:</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="c7ab" id="c7ab" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*9CMGL4mFb5hzEV-9oe3xkQ.png" data-width="1541" data-height="897" src="https://cdn-images-1.medium.com/max/1200/1*9CMGL4mFb5hzEV-9oe3xkQ.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="2ed1" id="2ed1" class="graf graf--p graf-after--figure">A few gotchas I encountered:</p><p name="fd40" id="fd40" class="graf graf--p graf-after--p">Flows configuration button missing in the GUI. This was super tricky as I had started configuring everything in the default Entra ID directory and not the B2C, so I had to repeat the whole configuration from scratch.</p><p name="24e6" id="24e6" class="graf graf--p graf-after--p graf--trailing">Also, this article came in handy while troubleshooting the configurations: <a href="https://stackoverflow.com/questions/72781554/azure-ad-b2c-breaks-oidc-spec" data-href="https://stackoverflow.com/questions/72781554/azure-ad-b2c-breaks-oidc-spec" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://stackoverflow.com/questions/72781554/azure-ad-b2c-breaks-oidc-spec</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@gvoden" class="p-author h-card">Georgi_V</a> on <a href="https://medium.com/p/926d8966141e"><time class="dt-published" datetime="2024-04-22T01:10:49.138Z">April 22, 2024</time></a>.</p><p><a href="https://medium.com/@gvoden/integrating-entra-b2c-with-amazon-api-gateway-using-jwt-authorizer-926d8966141e" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on August 24, 2025.</p></footer></article></body></html>